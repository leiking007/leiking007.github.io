---
title: "Redis"
date: 2020-11-12
lastmod: 2020-11-12
draft: false
tags: ['ä¸­é—´ä»¶']
categories: ["ğŸ§±ä¸­é—´ä»¶"]
author: "lei"
---

# Redis

## èµ·æ­¥

### ç®€ä»‹

- redisæ˜¯ä¸€ç§æ•°æ®åº“ã€‚èƒ½å¤Ÿå­˜å‚¨æ•°æ®ï¼Œç®¡ç†æ•°æ®çš„ä¸€ç§è½¯ä»¶
- redisåŸºäºCå¼€å‘ï¼Œå¼€æºï¼›åŸºäºå†…å­˜è¿è¡Œï¼Œæ•ˆç‡é«˜ï¼Œå¯æ”¯æŒæŒä¹…åŒ–
- redisæ•°æ®å¤§éƒ¨åˆ†æ—¶é—´å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€‚åˆå­˜å‚¨é¢‘ç¹è®¿é—®ï¼Œæ•°æ®é‡è¾ƒå°‘çš„æ•°æ®ï¼Œç¼“å­˜æ•°æ®åº“
- NoSQL ï¼ˆnot only sqlï¼‰æ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“
- NoSql
  - æ•°æ®é—´æ²¡æœ‰å…³ç³»ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å®ç°æ°´å¹³åˆ†å‰²
  - æ€§èƒ½å¥½ï¼Œå†™8w/sã€è¯»11w/s
- æ•°æ®åº“åº”ç”¨å‘å±•å†ç¨‹
  - å•æœºæ•°æ®åº“æ—¶ä»£ï¼šä¸€å°ç”µè„‘å®‰è£…ä¸€ä¸ªæ•°æ®åº“å¯¹åº”ä¸€ä¸ªåº”ç”¨ï¼Œä¸€å¯¹ä¸€
  - ç¼“å­˜ã€æ°´å¹³åˆ‡åˆ†æ—¶ä»£ï¼šæ ¹æ®ä¸šåŠ¡çš„ä¸åŒï¼Œå°†è¡¨æ”¾åˆ°ä¸åŒçš„æ•°æ®åº“
  - è¯»å†™åˆ†ç¦»æ—¶ä»£ï¼šåŒæ­¥æœºåˆ¶ã€å¤šä¸ªæ•°æ®åº“å®ä¾‹
  - å‚ç›´æ‹†åˆ†ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰æ—¶ä»£ï¼šé›†ç¾¤
- æ•°æ®åº“åˆ†ç±»
  - å…³ç³»å‹æ•°æ®åº“ï¼šmysqlã€oracleã€DB2ã€sqlserver
  - éå…³ç³»å‹æ•°æ®åº“ï¼šå½»åº•æ”¹å˜åº•å±‚å­˜å‚¨æœºåˆ¶ã€‚èšåˆæ•°æ®ç»“æ„å­˜å‚¨æ•°æ®ï¼Œä¸å†ä½¿ç”¨è¡¨è¿›è¡Œå­˜å‚¨ï¼›rediesã€mongoDBã€HBase...

### redisç‰¹ç‚¹

- æ”¯æŒæ•°æ®æŒä¹…åŒ–
- æ”¯æŒå¤šç§æ•°æ®ç»“æ„
- æ”¯æŒæ•°æ®å¤‡ä»½

### rediså®‰è£…

1. å®˜ç½‘ä¸‹è½½redisçš„tarå‹ç¼©åŒ…ï¼Œå¹¶è§£å‹
2. è¿›å…¥redisç›®å½•è¿›è¡Œç¼–è¯‘
   - éœ€è¦å…ˆå®‰è£…gccï¼Œ`make disclean` å‘½ä»¤å¯ä»¥æ¸…ç©ºç¼–è¯‘å¤±è´¥æ–‡ä»¶
   - ç„¶ååœ¨redisç›®å½•ä¸‹æ‰§è¡Œ `make` å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œç„¶åå·²ç»å¯ä»¥ä½¿ç”¨äº†(å½“å‰ç›®å½•çš„srcç›®å½•ä¸‹)
3. `make install`å‘½ä»¤ï¼Œå®‰è£…ï¼Œç±»ä¼¼åˆ›å»ºå¿«æ·æ–¹å¼ï¼ˆç›¸å…³å‘½ä»¤å®‰è£…åˆ°binç›®å½•ä¸‹ï¼‰
4. å¯åŠ¨redis 
   - `redis-server &`ï¼Œé»˜è®¤ç«¯å£6379ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤é…ç½®
   - `redis-server ../redis.conf  &` ï¼Œè‡ªå®šä¹‰é…ç½®å¯åŠ¨
5. å…³é—­redis
   - é€šè¿‡killå‘½ä»¤ï¼Œå¼ºåˆ¶æ€æ­»ï¼Œps -ed|grep redisã€kill -9 pid
   - `redis-cli shutdown`ï¼Œé€šè¿‡rediså‘½ä»¤è¿›è¡Œå…³é—­

## 3ç§å¸¸ç”¨çš„ç¼“å­˜è¯»å†™ç­–ç•¥

**è¿™3 ç§ç¼“å­˜è¯»å†™ç­–ç•¥å„æœ‰ä¼˜åŠ£ï¼Œä¸å­˜åœ¨æœ€ä½³ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‰æ‹©æ›´é€‚åˆçš„ã€‚**

### æ—è·¯ç¼“å­˜æ¨¡å¼

**æ—è·¯ç¼“å­˜æ¨¡å¼(Cache Aside Pattern) æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç¼“å­˜è¯»å†™æ¨¡å¼ï¼Œæ¯”è¾ƒé€‚åˆè¯»è¯·æ±‚æ¯”è¾ƒå¤šçš„åœºæ™¯**

Cache Aside Pattern ä¸­æœåŠ¡ç«¯éœ€è¦`åŒæ—¶ç»´ç³» DB å’Œ cache`ï¼Œå¹¶ä¸”æ˜¯ä»¥ DB çš„ç»“æœä¸ºå‡†ã€‚

**å†™ï¼š**

- å…ˆæ›´æ–° DB
- ç„¶åç›´æ¥åˆ é™¤ cache ã€‚

**è¯»** :

- ä» cache ä¸­è¯»å–æ•°æ®ï¼Œè¯»å–åˆ°å°±ç›´æ¥è¿”å›
- cacheä¸­è¯»å–ä¸åˆ°çš„è¯ï¼Œå°±ä» DB ä¸­è¯»å–æ•°æ®è¿”å›
- å†æŠŠæ•°æ®æ”¾åˆ° cache ä¸­ã€‚

**é—®é¢˜ï¼š**

**åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆåˆ é™¤ cache ï¼Œåæ›´æ–° DB ä¹ˆï¼Ÿ**

> ç­”ï¼šä¸å¯ä»¥ï¼Œä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼›è¯·æ±‚1å…ˆæŠŠcacheä¸­çš„Aæ•°æ®åˆ é™¤ -> è¯·æ±‚2ä»DBä¸­è¯»å–æ•°æ®->è¯·æ±‚1å†æŠŠDBä¸­çš„Aæ•°æ®æ›´æ–°ï¼›è¯·æ±‚2ä»DBä¸­è¯»å–æ•°æ®åä¼šå†™å…¥ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨è¯·æ±‚1æ›´æ–°ç»“æŸåï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä»ç„¶æ˜¯è„æ•°æ®ï¼Œä¸”ä¼šä¸€ç›´å­˜åœ¨

**åœ¨å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆæ›´æ–°DBï¼Œååˆ é™¤cacheå°±æ²¡æœ‰é—®é¢˜äº†ä¹ˆï¼Ÿ**

### è¯»å†™ç©¿é€



### å¼‚æ­¥ç¼“å­˜å†™å…¥



## rediså‘½ä»¤

### rediså®¢æˆ·ç«¯

- ç”¨äºé“¾æ¥redisæœåŠ¡ï¼Œç›¸redisæœåŠ¡ç«¯å‘é€å‘½ä»¤ï¼Œå¹¶æ˜¾ç¤ºredisæœåŠ¡å¤„ç†ç»“æœ
- redis-cliï¼šrediså®‰è£…å¥½åè‡ªå¸¦çš„å®¢æˆ·ç«¯ ï¼Œ`redis-cli`å¯åŠ¨è‡ªå¸¦å®¢æˆ·ç«¯ï¼Œè‡ªåŠ¨é“¾æ¥redisæœåŠ¡å™¨ï¼Œä¸éœ€è¦å¯†ç 
  - `redis-cli`ï¼šé»˜è®¤é“¾æ¥æœ¬æœº127.0.0.1çš„6379ç«¯å£ä¸Šçš„redisæœåŠ¡
  - `redis-cli -p ç«¯å£`ï¼šé“¾æ¥127.0.0.1çš„æŒ‡å®šç«¯å£ä¸Šçš„redisæœåŠ¡
  - `redis-cli  -h ipåœ°å€ -p ç«¯å£`ï¼šé“¾æ¥æŒ‡å®šipä¸»æœºä¸ŠæŒ‡å®šç«¯å£çš„redisæœåŠ¡
- `exit/quit:`é€€å‡ºå®¢æˆ·ç«¯
- ç¬¬ä¸‰æ–¹rediså®¢æˆ·ç«¯è¿æ¥å·¥å…·ï¼šredis-desktop-manager.exe

### åŸºæœ¬æ¦‚å¿µ

- `redis-benchmark`ï¼šæµ‹è¯•redisæœåŠ¡çš„æ€§èƒ½
- `ping `ï¼šæŸ¥çœ‹redisæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œåœ¨rediså®¢æˆ·ç«¯å‘é€ä¿¡æ¯åˆ°æœåŠ¡ç«¯
- `info`ï¼šæŸ¥çœ‹redisæœåŠ¡å™¨çš„æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯ï¼Œåœ¨rediså®¢æˆ·ç«¯ä½¿ç”¨
  - `info [ä¿¡æ¯æ®µ]`ï¼šæŸ¥çœ‹æœåŠ¡å™¨æŒ‡å®šç»Ÿè®¡ä¿¡æ¯ï¼Œinfo Replication
- redisé»˜è®¤æœ‰16ä¸ªåº“ï¼Œæ•°æ®åº“å®ä¾‹
  - redisä¸­æ•°æ®åº“å®ä¾‹ï¼Œåªèƒ½ç”±redisæœåŠ¡æ¥åˆ›å»ºå’Œç»´æŠ¤ï¼›é»˜è®¤åˆ›å»º16ä¸ªåº“ï¼Œä¸”é‡‡ç”¨ç¼–å·0-15è¿›è¡Œå‘½å
  - å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šredisæœåŠ¡é»˜è®¤åˆ›å»ºçš„åº“ï¼ˆæ•°æ®åº“å®ä¾‹ï¼‰
  - redisæ¯ä¸€ä¸ªæ•°æ®åº“å®ä¾‹å ç”¨ç©ºé—´å¾ˆå°‘ï¼Œæ‰€ä»¥é»˜è®¤åˆ›å»ºçš„16ä¸ªåº“ï¼Œå³ä½¿ä¸ç”¨ï¼Œä¹Ÿä¸å­˜åœ¨æµªè´¹
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œ`redis-cli`è¿æ¥çš„æ˜¯ç¼–å·ä¸º0çš„æ•°æ®åº“å®ä¾‹
  - `select ç¼–å·`ï¼šç”¨äºåˆ‡æ¢æ•°æ®åº“å®ä¾‹ï¼›å¦‚åˆ‡æ¢åˆ°ç¼–å·ä¸º2çš„ï¼šselect 2
- `set key value`ï¼šå­˜å‚¨æ•°æ®
- `get key`ï¼šè·å–keyå¯¹åº”çš„å€¼
- `dbsize`ï¼šæŸ¥çœ‹å½“å‰æ•°æ®å®ä¾‹ä¸­æ‰€æœ‰çš„keyä¸ªæ•°
- `keys *`ï¼šæŸ¥çœ‹æ‰€æœ‰çš„key
- `flushdb`ï¼šæ¸…ç©ºå½“å‰æ•°æ®åº“å®ä¾‹
- `flushall`ï¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®åº“å®ä¾‹
- `config get *`ï¼šæŸ¥çœ‹redisä¸­æ‰€æœ‰çš„é…ç½®ä¿¡æ¯

### redisæ•°æ®ç»“æ„

redisæ”¯æŒäº”ç§æ•°æ®ç»“æ„

ä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨åœ¨redisçš„ä¸åŒæ•°æ®ç»“æ„ä¸­

- å­—ç¬¦ä¸²ï¼šå•key-å•valueï¼›å­˜åœ¨ä¸‹æ ‡ï¼Œä¸‹æ ‡æœ‰ä¸¤ç§å†™æ³•ï¼Œä»å·¦è‡³å³ 0-->len-1ï¼Œä»å³è‡³å·¦ -1-->-len
- liståˆ—è¡¨ï¼šå•key-å¤švalueï¼Œvalueæœ‰åºï¼›é“¾è¡¨å®ç°ï¼›æ ¹æ®æ”¾å…¥é¡ºåºæ’åº
- seté›†åˆï¼šå•key-å¤švalueï¼Œvalueæ— åº
- zsetæœ‰åºé›†åˆï¼šå•key-å¤švalueï¼Œvalueæœ‰åºï¼›hashå’Œè·³è·ƒè¡¨å®ç°ï¼›é€šè¿‡ä¸€ä¸ªå‚è€ƒå€¼æ’åº
- hashå“ˆå¸Œï¼šå•key-å¯¹è±¡ï¼ˆå±æ€§ï¼šå€¼ï¼‰ï¼›é€‚åˆå­˜å‚¨å¯¹è±¡

### keyæ“ä½œ

- `keys pattern`ï¼šæŸ¥è¯¢ä¸é€šé…ç¬¦åŒ¹é…çš„keyï¼›* åŒ¹é…0ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ã€ï¼Ÿ åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€[]  åŒ¹é…[]ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦
- `exists [k1]`ï¼šåˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ï¼›exists k1 k2 ... åˆ¤æ–­å¤šä¸ªkeyæ˜¯å¦å­˜åœ¨
- `move k1 index` ï¼šç§»åŠ¨æŸä¸€ä¸ªkeyåˆ°æŒ‡å®šæ•°æ®åº“å®ä¾‹
- `ttl k1`ï¼šæŸ¥çœ‹æŒ‡å®šk1çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ï¼›æ•°æ®æ”¾çš„æ—¶å€™å¯ä»¥è®¾å®šä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒèŠ‚çœå†…å­˜ï¼›keyä¸å­˜åœ¨ï¼Œè¿”å›-2ï¼›æ²¡æœ‰ç”Ÿå‘½æ—¶é—´ï¼Œè¿”å›-1
- `expire k1 seconds`ï¼šè®¾ç½®keyçš„æœ€å¤§ç”Ÿå­˜æ—¶é—´
- `type k1`ï¼šæŸ¥çœ‹æŒ‡å®škeyçš„æ•°æ®ç±»å‹
- `rename k1 newk1`ï¼šé‡å‘½åkeyï¼Œä¸æ¨è
- `del k1`ï¼šåˆ é™¤keyï¼ˆåŒ…æ‹¬å€¼ï¼‰ï¼›å¯åˆ é™¤å¤šä¸ªkeyï¼Œç©ºå·éš”å¼€ã€‚è¿”å›å€¼ä¸ºå®é™…åˆ é™¤keyçš„æ•°é‡
- `flushall`ï¼šæ¸…ç©ºå½“å‰è¡¨

### å­—ç¬¦ä¸²æ“ä½œ

- `set é”® å€¼`ï¼šå­˜å…¥stringæ•°æ®åˆ°redisæ•°æ®åº“ï¼›å¦‚æœkeyå·²å­˜åœ¨ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ï¼›set k1 value1
- `get é”®`ï¼šé€šè¿‡é”®è·å–stringå€¼ï¼›get k1
- `append k1 v1`ï¼šè¿½åŠ å­—ç¬¦ï¼›å‘æŒ‡å®škeyçš„å€¼åé¢è¿½åŠ å­—ç¬¦ä¸²ï¼Œè¿”å›è¿½åŠ åå­—ç¬¦ä¸²é•¿åº¦ï¼›keyä¸å­˜åœ¨ï¼Œæ–°å»ºkey
- `strlen k1`ï¼šè·å–æŒ‡å®škeyçš„å­—ç¬¦ä¸²æ•°æ®çš„é•¿åº¦
- `incr k1`ï¼šå¯¹å­—ç¬¦ä¸²æ•°å€¼è¿›è¡ŒåŠ 1è¿ç®—ï¼Œkeyå¯¹åº”çš„æ•°æ®å¿…é¡»ä¸ºå­—ç¬¦ä¸²æ•°å€¼ï¼›è¿”å›åŠ 1ä¹‹åçš„è¿ç®—æ•°æ®ï¼›keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®keyå¹¶åˆå§‹åŒ–å€¼ä¸º0ï¼Œç„¶åè¿ç®—è¿”å›1
- `decr k1`ï¼šå¯¹å­—ç¬¦ä¸²æ•°å€¼è¿›è¡Œå‡1è¿ç®—ï¼Œkeyå¯¹åº”çš„æ•°æ®å¿…é¡»ä¸ºå­—ç¬¦ä¸²æ•°å€¼ï¼›è¿”å›å‡1ä¹‹åçš„è¿ç®—æ•°æ®ï¼›keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®keyå¹¶åˆå§‹åŒ–å€¼ä¸º0ï¼Œç„¶åè¿ç®—è¿”å›-1
- `incrby k1 offset`ï¼šå¯¹å­—ç¬¦ä¸²æ•°å€¼è¿›è¡Œ+offsetè¿ç®—ï¼›è¿”å›è¿ç®—åæ•°æ®ï¼›ï¼›keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®keyå¹¶åˆå§‹åŒ–å€¼ä¸º0ï¼Œç„¶åè¿ç®—è¿”å›ç»“æœ
- `decrby k1 offset`ï¼šå¯¹å­—ç¬¦ä¸²æ•°å€¼è¿›è¡Œ-offsetè¿ç®—ï¼›è¿”å›è¿ç®—åæ•°æ®ï¼›ï¼›keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®keyå¹¶åˆå§‹åŒ–å€¼ä¸º0ï¼Œç„¶åè¿ç®—è¿”å›ç»“æœ
- `getrange k1 startIndex endIndex`ï¼šæˆªå–å­—ç¬¦ä¸²ä¸­å­å­—ç¬¦ä¸²ï¼›ä¸‹æ ‡ä»0å¼€å§‹ï¼Œè‡ªå·¦è‡³å³ï¼›é—­åŒºé—´æˆªå–
- `setrang k1 startIndex value `ï¼šå°†æŒ‡å®šçš„å­—ç¬¦ä¸²ä»æŒ‡å®šä¸‹æ ‡å¼€å§‹ï¼Œä¿®æ”¹ä¸ºæŒ‡å®švalueï¼Œè¿”å›è¦†ç›–åçš„å­—ç¬¦ä¸²é•¿åº¦
- `setex k1 v1`ï¼šè®¾ç½®å­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œè®¾ç½®æœ€å¤§ç”Ÿå­˜æ—¶é—´
- `setnx k1 v1`ï¼šå½“ä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®å­—ç¬¦ä¸²ï¼›å’Œsetå‘½ä»¤ä¸åŒçš„æ˜¯ä¸ä¼šè¦†ç›–
- `mset k1 v1 k2 v2 ...`ï¼šæ‰¹é‡è®¾ç½®å¤šä¸ªå­—ç¬¦ä¸²åˆ°redisåº“ä¸­ï¼›ç©ºæ ¼éš”å¼€
- `mget k1 k2 ...`ï¼šæ‰¹é‡ä»redisè·å–stringç±»å‹æ•°æ®
- `msetnx k1 v1 k2 v2 ...`ï¼šæ‰€æœ‰keyä¸å­˜åœ¨æ—¶è®¾ç½®æˆåŠŸï¼Œå¦åˆ™å…¨éƒ¨æ”¾å¼ƒè®¾ç½®

### listæ“ä½œ

- è®¾ç½®å€¼
  - `rpush k1 v1 [v1 v2]`ï¼šåœ¨é“¾è¡¨å°¾æ’å…¥æ•°æ®
  - `lpush k1 v1 [v2 v3]`ï¼šåœ¨é“¾è¡¨å¤´æ’å…¥æ•°æ®
  - `lset key index element`ï¼šé€šè¿‡åˆ—è¡¨ä¸‹æ ‡è®¾ç½®å…ƒç´ å€¼
- è·å–å€¼
  - `llen key`ï¼šè·å–æŒ‡å®škeyçš„åˆ—è¡¨é•¿åº¦
  - `lrange key start stop`ï¼šè·å–keyçš„æŒ‡å®šåŒºé—´çš„åˆ—è¡¨å…ƒç´ 
  - `lindex key index`ï¼šè·å–åˆ—è¡¨æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ 
- åˆ é™¤æ•°æ®
  - `lpop key [count]`ï¼šä»è¡¨å¤´ç§»é™¤æŒ‡å®šä¸ªæ•°çš„å…ƒç´ 
  - `rpop key [count]`ï¼šä»è¡¨å°¾ç§»é™¤æŒ‡å®šä¸ªæ•°çš„å…ƒç´ 
  - `brpop key [key ...] timeout`ï¼šä»åˆ—è¡¨å°¾ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºè¢«ç§»é™¤å…ƒç´ ï¼Œtimeoutè¡¨ç¤ºæ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æ—¶é—´
  - `blpop key [key ...] timeout`ï¼šä»åˆ—è¡¨å¤´ç§»é™¤ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºè¢«ç§»é™¤å…ƒç´ ï¼Œtimeoutè¡¨ç¤ºæ²¡æœ‰å…ƒç´ æ—¶ç­‰å¾…æ—¶é—´
  - `lrem key count element`ï¼šç§»é™¤æŒ‡å®švalueçš„å…ƒç´ ï¼ŒcountæŒ‡å®šç§»é™¤å¤šå°‘ä¸ªï¼ˆå¯èƒ½æœ‰å¤šä¸ªç›¸åŒçš„æ•°æ®ï¼‰ï¼›count>0 ä»å·¦ä¾§ç§»é™¤æŒ‡å®šä¸ªã€count<0 ä»å³ä¾§ç§»é™¤æŒ‡å®šä¸ªã€count=0 åˆ é™¤åˆ—è¡¨æ‰€æœ‰ä¸valueç›¸ç­‰çš„å€¼

### setæ“ä½œ

- è®¾ç½®
  - `sadd key member [member ...]`ï¼šå‘é›†åˆæ·»åŠ å…ƒç´ ï¼Œæ— åºä¸é‡å¤ï¼Œé€šè¿‡hashæ’å…¥ï¼Œå…ƒç´ é‡å¤å¿½ç•¥
- è·å–
  - `scard key`ï¼šè·å–é›†åˆå…ƒç´ ä¸ªæ•°
  - `srandmember key [count]`ï¼šéšæœºè¿”å›é›†åˆä¸­æŒ‡å®šä¸ªæ•°å…ƒç´ ã€‚count<0 å¯èƒ½è¿”å›é‡å¤å…ƒç´ ã€count>0 è¿”å›ä¸é‡å¤å…ƒç´ 
  - `sinter key [key ...]`ï¼šè¿”å›ç»™å®šé›†åˆçš„äº¤é›†
  - `sdiff key [key ...]`ï¼šè¿”å›ä¸€ä¸ªé›†åˆä¸­æœ‰ï¼Œå…¶ä»–é›†åˆä¸­æ²¡æœ‰çš„å…ƒç´ ï¼Œå·®é›†
  - `sunion key [key ...]`ï¼šè¿”å›ç»™å®šé›†åˆå¹¶é›†
  - `sdiffstore/sinterstore/sunionstore destination key [key ...]`ï¼šå°†è·å–çš„äº¤é›†/å·®é›†/å¹¶é›†ï¼Œæ”¾å…¥æ–°çš„é›†åˆ
  - `sismember key member`ï¼šåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨æŒ‡å®šé›†åˆä¸­
- åˆ é™¤
  - `srem key member [member ...]`ï¼šç§»é™¤é›†åˆä¸­æŒ‡å®šå…ƒç´ ï¼Œä¸å­˜åœ¨å…ƒç´ å¿½ç•¥ï¼Œè¿”å›æˆåŠŸç§»é™¤ä¸ªæ•°
  - `spop key [count]`ï¼šéšæœºç§»é™¤æŒ‡å®šé›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ 
  - `smove source destination member`ï¼šç§»é™¤é›†åˆä¸­æŒ‡å®šå…ƒç´ åˆ°å¦ä¸€ä¸ªé›†åˆ

### zsetæ“ä½œ

- è®¾ç½®
  - zsetçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªåˆ†æ•°ï¼Œåˆ†æ•°å¯ä»¥é‡å¤ï¼Œå…ƒç´ ä¸èƒ½é‡å¤ï¼›zsetæ ¹æ®åˆ†æ•°å¯¹é›†åˆä¸­å…ƒç´ æ’åº
  - `zadd key [NX|XX] [GT|LT] [CH] [INCR] score member [score member`ï¼šå‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°
- è·å–
  - `zcard key`ï¼šè·å–zsetä¸­å…ƒç´ ä¸ªæ•°
  - `zcount key min max`ï¼šè·å–zsetæŒ‡å®šåˆ†æ•°åŒºé—´çš„å…ƒç´ ä¸ªæ•°
  - `zrangebyscore key min max [WITHSCORES] [LIMIT offset count]`ï¼šè·å–æŒ‡å®šåˆ†æ•°åŒºé—´çš„å…ƒç´ 
  - `zrange key min max [BYSCORE|BYLEX] [REV] [LIMIT offset count] [WITHSCORES]`ï¼šè·å–æŒ‡å®šæ’ååŒºé—´çš„å…ƒç´ 
  - `zrank key member`ï¼šè·å–zsetä¸­æŒ‡å®šå…ƒç´ æ’åï¼ˆå‡åºï¼Œå°åˆ°å¤§ï¼‰
  - `zrevrank key member`ï¼šè·å–zsetä¸­æŒ‡å®šå…ƒç´ æ’åï¼ˆå¤§åˆ°å°ï¼‰
  - `zscore key member`ï¼šè·å–æŒ‡å®šå…ƒç´ åˆ†æ•°
- åˆ é™¤
  - `zrem key member [member ...]`ï¼šç§»é™¤zsetä¸­æŒ‡å®šçš„å…ƒç´ 

### hashæ“ä½œ

- è®¾ç½®
  - `hset key field value [field value ...]`ï¼šè®¾ç½®hashè¡¨ï¼Œå¦‚æœå­—æ®µå·²å­˜åœ¨ä¼šè¦†ç›–åŸæœ¬value
  - `hmset key field value [field value ...]`ï¼šè®¾ç½®hashè¡¨
  - `hsetnx key field value`ï¼šç»™æŒ‡å®šhashè¡¨è®¾ç½®ä¸€ä¸ªfiled-valueï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œæ”¾å¼ƒè®¾ç½®
- è·å–
  - `hkeys key`ï¼šè·å–æŒ‡å®šhashå¯¹è±¡çš„æ‰€æœ‰å­—æ®µ
  - `hvals key`ï¼šè·å–æŒ‡å®šhashè¡¨æ‰€æœ‰å€¼
  - `hget key field`ï¼šè·å–æŒ‡å®šhashè¡¨çš„æŒ‡å®šå­—æ®µå€¼ï¼Œè·å–å•ä¸ª
  - `hmget key field [field ...]`ï¼šè·å–æŒ‡å®šhashè¡¨çš„æŒ‡å®šå­—æ®µå€¼ï¼Œæ‰¹é‡è·å–
  - `hgetall key`ï¼šè·å–æŒ‡å®šhashè¡¨ä¸­æ‰€æœ‰å­—æ®µå’Œå€¼
  - `hlen key`ï¼šè·å–æŒ‡å®šhashè¡¨å­—æ®µä¸ªæ•°
  - `hexists key field`ï¼šåˆ¤æ–­æŒ‡å®šhashè¡¨æ˜¯å¦å­˜åœ¨æŒ‡å®šfiledï¼ˆåŸŸï¼‰
  - `hincrby key field increment`ï¼šå¯¹hashè¡¨æŒ‡å®šå­—æ®µåšåŠ æ³•è¿ç®—ï¼Œæ•´æ•°
  - `hincrbyfloat key field increment`ï¼šå¯¹hashè¡¨æŒ‡å®šå­—æ®µåšåŠ æ³•è¿ç®—ï¼Œå°æ•°
- åˆ é™¤
  - `hdel key field [field ...]`ï¼šä»æŒ‡å®šhashè¡¨åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªfieldï¼ˆåŸŸï¼‰

## é…ç½®æ–‡ä»¶

### ç®€ä»‹

- redisæ ¹ç›®å½•ä¸‹æä¾›ä¸€ä¸ªredis.confé…ç½®æ–‡ä»¶
- å¯ä»¥é…ç½®redisæœåŠ¡ç«¯è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°
- ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ŒredisæœåŠ¡é‡‡ç”¨é»˜è®¤å‚æ•°è¿è¡Œ
- redisæœåŠ¡å¯åŠ¨æ—¶å¯ä»¥æŒ‡å®šé…ç½®æ–‡ä»¶

**ç½‘ç»œé…ç½®**

- portï¼šæŒ‡å®šredisæœåŠ¡æ‰€ä½¿ç”¨çš„ç«¯å£
- bindï¼šé…ç½®å®¢æˆ·ç«¯é“¾æ¥redisæœåŠ¡æ—¶ï¼Œæ‰€èƒ½ä½¿ç”¨çš„ipåœ°å€ï¼›é»˜è®¤ä½¿ç”¨redisæœåŠ¡å™¨ä¸Šä»»æ„ç½‘å¡ipåœ°å€éƒ½è¡Œ
- tcp-keepaliveï¼šé“¾æ¥ä¿æ´»ç­–ç•¥ï¼Œå•ä½ä¸ºç§’ï¼›ä»¥æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦å·²æŒ‚æ‰ï¼Œå¯¹äºæ— å“åº”çš„å®¢æˆ·ç«¯ä¼šå…³é—­å…¶é“¾æ¥
- å®¢æˆ·ç«¯é“¾æ¥ï¼šredis-cli -h ipåœ°å€ -p ç«¯å£å·

**å¸¸è§„é…ç½®**

- loglevelï¼šé…ç½®æ—¥å¿—çº§åˆ«
- logfileï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶ã€‚redisåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¾“å‡ºä¸€äº›æ—¥å¿—ä¿¡æ¯ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ—¥å¿—ä¿¡æ¯ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¯ä»¥ä½¿ç”¨logfileå°†æ—¥å¿—ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶
- databasesï¼šé…ç½®rediså¯åŠ¨é»˜è®¤é…ç½®å¤šå°‘ä¸ªæ•°æ®åº“å®ä¾‹

**å®‰å…¨é…ç½®**

- requirepassï¼šé…ç½®è®¿é—®redisæœåŠ¡æ—¶æ‰€ä½¿ç”¨çš„å¯†ç ï¼›ä¸æ¨è
- protected-mode=yesï¼šrediså®‰å…¨æ¨¡å¼ï¼Œé…ç½®å¯†ç è®¿é—®æ—¶éœ€è¦é…ç½®ä¸ºyesï¼›å®é™…ä½¿ç”¨æ—¶éƒ½é…ç½®ä¸ºnoï¼Œä¸åšæƒé™ç­‰éªŒè¯

### ç¤ºä¾‹

```text
#------ ç½‘ç»œ --------#
port 6379
bind * -::*
tcp-keepalive 300

#----- å®‰å…¨ ------#
requirepass 123456
## éœ€è¦å¯†ç è¿›è¡Œè®¿é—®
## protected-mode yes

#-------- é›†ç¾¤ -----------#
## cluster-enabled yes
## cluster-config-file nodes-6379.conf
## cluster-node-timeout 15000

#--------- ç¾¤é›†DOCKER/NATæ”¯æŒ ----------#
cluster-announce-ip 172.28.0.1${port}
cluster-announce-port 6379
cluster-announce-bus-port 16379

## å¼€å¯aof
appendonly yes
```



## æŒä¹…åŒ–

redisæä¾›æŒä¹…åŒ–ç­–ç•¥ï¼Œåœ¨é€‚å½“çš„æ—¶æœºé‡‡ç”¨é€‚å½“çš„æ‰‹æ®µæŠŠå†…å­˜ä¸­æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œæ¯æ¬¡å¯åŠ¨redisæ—¶ï¼Œéƒ½å¯ä»¥æŠŠç£ç›˜ä¸Šçš„æ•°æ®å†æ¬¡åŠ è½½åˆ°å†…å­˜ä¸­ä½¿ç”¨

### RDBç­–ç•¥

- åœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…ï¼ŒredisæœåŠ¡æ‰§è¡ŒæŒ‡å®šæ¬¡æ•°çš„å†™æ“ä½œï¼Œä¼šè‡ªåŠ¨è§¦å‘ä¸€æ¬¡æŒä¹…åŒ–æ“ä½œ
- é…ç½®æ–‡ä»¶
  - save æ—¶é—´ æ¬¡æ•°ï¼šå¯ä»¥ä¿®æ”¹ç­–ç•¥ï¼ˆå•ä½ä¸ºç§’ï¼‰
  - dbfilename nameï¼šredis RDBæŒä¹…åŒ–ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºdump.rdb
  - dirï¼šé…ç½®RDBæŒä¹…åŒ–æ‰€å­˜åœ¨çš„ç›®å½•
- RDBæ˜¯redisé»˜è®¤ç­–ç•¥ï¼Œrediså¼€å¯æ—¶è‡ªåŠ¨å¼€å¯è¯¥ç­–ç•¥
- ç¼ºé™·ï¼šå¯èƒ½æœ‰å°‘éƒ¨åˆ†æ•°æ®ä¸¢å¤±

### AOFç­–ç•¥

- é‡‡ç”¨æ“ä½œæ—¥å¿—æ¥è®°å½•redisè¿›è¡Œçš„æ¯ä¸€æ¬¡å†™æ“ä½œï¼Œæ¯æ¬¡redisæœåŠ¡å¯åŠ¨æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éæ“ä½œæ—¥å¿—
- æ•ˆç‡æ¯”RDBæŒä¹…åŒ–ç­–ç•¥ä½ï¼Œredisé»˜è®¤ä¸å¼€å¯AOFæŒä¹…åŒ–ç­–ç•¥
- é…ç½®æ–‡ä»¶
  - appendonlyï¼šé…ç½®æ˜¯å¦å¼€å¯AOFï¼Œyesè¡¨ç¤ºå¼€å¯ï¼Œnoè¡¨ç¤ºå…³é—­ã€‚é»˜è®¤ä¸ºno
  - appendfilenameï¼šAOFä¿å­˜æ–‡ä»¶å
  - appendfsyncï¼šAOFå¼‚æ­¥æŒä¹…åŒ–ç­–ç•¥ï¼›awaysï¼ŒåŒæ­¥æŒä¹…åŒ–ï¼Œæ¯æ¬¡æ•°æ®å‘ç”Ÿå˜åŒ–ä¼šç«‹å³å†™å…¥åˆ°ç£ç›˜ä¸­ï¼›everysecï¼Œå‡ºå‚é»˜è®¤æ¨èï¼Œç¾å¦™å¼‚æ­¥è®°å½•ä¸€æ¬¡ï¼ˆé»˜è®¤ï¼‰ã€noï¼Œä¸å³æ—¶åŒæ­¥ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶åŒæ­¥

### å°ç»“

æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹å†³å®šå¼€å¯å“ªç§æŒä¹…åŒ–ç­–ç•¥

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼€å¯RDBè¶³å¤Ÿäº†

## redisäº‹åŠ¡

 äº‹åŠ¡ï¼šä¸€ç»„æ•°æ®åº“çš„å†™æ“ä½œæ”¾åœ¨ä¸€èµ·æ‰§è¡Œï¼Œä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥

redisäº‹åŠ¡ï¼šå…è®¸æŠŠä¸€ç»„rediså‘½ä»¤æ”¾åœ¨ä¸€èµ·æ‰§è¡Œï¼ŒæŠŠå‘½ä»¤è¿›è¡Œåºåˆ—åŒ–ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰ï¼Œç„¶åä¸€èµ·æ‰§è¡Œï¼Œä¿è¯éƒ¨åˆ†åŸå­æ€§ï¼ˆé‡è¦é”™è¯¯æ—¶ï¼‰ï¼Œä¿è¯ä»¥ä¸‹ä¸‰ç‚¹

- æ‰¹é‡æ“ä½œåœ¨å‘é€ EXEC å‘½ä»¤å‰è¢«æ”¾å…¥é˜Ÿåˆ—ç¼“å­˜ã€‚
- æ”¶åˆ° EXEC å‘½ä»¤åè¿›å…¥äº‹åŠ¡æ‰§è¡Œï¼Œäº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™çš„å‘½ä»¤ä¾ç„¶è¢«æ‰§è¡Œã€‚
- åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åºåˆ—ä¸­

### å®ç°

- `multi`ï¼šæ ‡è®°äº‹åŠ¡çš„å¼€å§‹
- `exec`ï¼šäº‹åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»£ç çš„æ‰§è¡Œ
- `discard`ï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒäº‹åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰å‘½ä»¤
- `watch key [key ...]`ï¼šç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­
- `unwatch`ï¼šæ”¾å¼ƒç›‘æ§æ‰€æœ‰key

- redisåªèƒ½ä¿è¯éƒ¨åˆ†åŸå­æ€§ï¼Œå‹å…¥äº‹åŠ¡é˜Ÿåˆ—æ—¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™äº‹åŠ¡é˜Ÿåˆ—ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¸æ‰§è¡Œ
- å¯ç†è§£ä¸ºæ‰“åŒ…çš„æ‰¹é‡æ‰§è¡Œè„šæœ¬
- å¯ä»¥é€šè¿‡ç›‘æ§ä¸€ä¸ªå˜é‡ï¼Œå®ç°ç®€æ˜“çš„é”è£…ç½®

### å°ç»“

- å•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ï¼Œé™¤éä½¿ç”¨`watch`ç›‘æ§å‘½ä»¤
- ä¸ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼šredis åŒä¸€äº‹åŠ¡å¦‚æœä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶å¯èƒ½ä¼šè¢«æ‰§è¡Œï¼Œredisçš„äº‹åŠ¡æ²¡æœ‰å›æ»šã€‚rediså·²ç»åœ¨ç³»ç»Ÿå†…éƒ¨è¿›è¡ŒåŠŸèƒ½ç®€åŒ–ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ›´å¿«çš„è¿è¡Œé€Ÿåº¦ï¼Œå› ä¸ºredisä¸éœ€è¦äº‹åŠ¡å›æ»šèƒ½åŠ›

## rediså‘å¸ƒä¸è®¢é˜…

Redis å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚

![img](index.assets/pubsub1.png)

å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ PUBLISH å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š

![img](index.assets/pubsub2.png)

rediså®¢æˆ·ç«¯è®¢é˜…é¢‘é“ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…å¾€é¢‘é“ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…æ­¤é¢‘é“çš„å®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿæ¥æ”¶åˆ°æ¶ˆæ¯

1. `subscribe channel [channel ...]`ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯
2. `publish channel message`ï¼šå°†æ¶ˆæ¯å‘å¸ƒåˆ°æŒ‡å®šé¢‘é“
3. `psubscribe pattern [pattern ...]`ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“ï¼Œå‚æ•°æ”¯æŒé€šé…ç¬¦
4. `unsubscribe [channel [channel ...]]`ï¼šé€€è®¢ç»™å®šçš„é¢‘é“
5. `punsubscribe [pattern [pattern ...]]`ï¼šé€€è®¢ç»™å®šçš„é¢‘é“ï¼Œæ”¯æŒé€šé…ç¬¦
6. å¯ä»¥å®ç°å®¢æˆ·ç«¯é€šä¿¡

## redisé›†ç¾¤

å½“ä¸€å°redisæœåŠ¡å™¨å¤„ç†åˆ°ä¸Šé™æ—¶ï¼Œéœ€è¦æ­å»ºredisé›†ç¾¤

### æ­å»ºä¸‰å°redisæœåŠ¡å™¨

1. æ­å»ºä¸‰å°redisæœåŠ¡

2. æŸ¥çœ‹ä¸‰å°redisæœåŠ¡åœ¨é›†ç¾¤ä¸­çš„ä¸»ä»è§’è‰²ï¼Œé»˜è®¤éƒ½æ˜¯ä¸»æœºï¼Œäº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“

   `info replication`ï¼šæŸ¥çœ‹redisä¸­çš„replication

   ```bash
   127.0.0.1:6380> info replication
   ## Replication
   role:master			//maskterä»£è¡¨ä¸»æœº
   connected_slaves:0
   master_failover_state:no-failover
   master_replid:b72c556d73d7d9d121ec3215bd6d9286a738fd10
   master_replid2:0000000000000000000000000000000000000000
   master_repl_offset:0
   second_repl_offset:-1
   repl_backlog_active:0
   repl_backlog_size:1048576
   repl_backlog_first_byte_offset:0
   repl_backlog_histlen:0
   ```


### redisä¸»ä»å¤åˆ¶ï¼ˆé›†ç¾¤ï¼‰

- å­˜åœ¨ä¸»åº“masterè´Ÿè´£å†™ã€ä»åº“slaveè´Ÿè´£è¯»ï¼Œä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œè‡ªåŠ¨åŒæ­¥åˆ°ä»æœºmaster/slaveæœºåˆ¶
- ä¸»å¤šä»å°‘ã€ä¸»å†™ä»è¯»ã€è¯»å†™åˆ†ç¦»ã€ä¸»å†™åŒæ­¥å¤åˆ¶åˆ°ä»
- æ­å»ºä¸€ä¸»äºŒä»redisé›†ç¾¤
- è®¾ç½®ä¸»ä»å…³ç³»ï¼šè®¾ä»ä¸è®¾ä¸»
  1. åœ¨ä»æœºä¸Šè®¾ç½®è¯¥æœºä»å±äºå“ªå°ä¸»æœº
  2. `slaveof ip port`ï¼šè®¾ç½®è¯¥ä»æœºå±äºå“ªå°redisä¸»æœº
  3. è®¾ç½®æˆåŠŸåï¼Œä¸»æœºä¸Šçš„æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥åˆ°ä»æœº
  4. ä»æœºåªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™
- ç›¸å…³å¼‚å¸¸

  2. ä¸»æœºå®•æœºï¼Œå…³é—­ä¸»æœºï¼›ä»æœºåŸåœ°å¾…å‘½ï¼Œç­‰å¾…ä¸»æœº
  3. ä¸»æœºæ¢å¤ï¼Œé‡å¯ä¸»æœºï¼›ä¸€åˆ‡æ¢å¤
  4. ä»æœºå®•æœºï¼Œä¸»æœºå°‘ä¸€ä¸ªä»æœºï¼Œä»æœºä¸å˜
  5. ä»æœºæ¢å¤ï¼Œéœ€è¦é‡æ–°è®¾ç½®ä¸»ä»å…³ç³»ï¼Œå¦åˆ™å®ƒä¸å½’å±äºä»»ä½•ä¸»æœº
  5. ä»æœºä¸Šä½ï¼ˆåç»­ä½¿ç”¨å“¨å…µæ¨¡å¼ï¼‰ï¼šä¸»æœºå®•æœºï¼Œä»æœºå¾…å‘½
     1. ä»æœºæ–­å¼€åŸæ¥çš„ä¸»ä»å…³ç³»ï¼š`slaveof no one`
     2. é‡æ–°è®¾ç½®å…¶ä»–ä»æœºçš„ä¸»ä»å…³ç³»ï¼š`slaveof host port`
     3. ä¸»æœºåœ¨æ­¤æ—¶æ¢å¤ã€æ²¡æœ‰ä»æœºäº†ï¼šå¯ä»¥åŠ å…¥åŸæ¥é›†ç¾¤å½“ä»æœºï¼Œä¹Ÿå¯é‡æ–°é…ç½®ä¸»ä»å…³ç³»
- å…¨é‡å¤åˆ¶ï¼šä¸€æ—¦ä¸»ä»å…³ç³»ç¡®å®šï¼Œä¼šè‡ªåŠ¨æŠŠä¸»æœºä¸Šå·²æœ‰çš„æ•°æ®åŒæ­¥å¤åˆ¶åˆ°ä»åº“

### è§‚ç‚¹

- ä¸€å°ä¸»æœºå¯ä»¥æœ‰å¤šå°ä»æœºï¼Œä¸€å°ä»æœºå¯ä»¥æœ‰ä¸€ä¸ªä¸»æœºå’Œå¤šå°ä»æœº
  - å‡è½»ä¸»æœºå‹åŠ›
  - å¢åŠ äº†æœåŠ¡é—´çš„å»¶æ—¶å…³ç³»
- redisé›†ç¾¤ä¸­ï¼Œä¸»è¦æœ‰ä»å…³ç³»çš„ï¼Œæ— è®ºå®ƒä¸‹é¢è¿˜æœ‰æ²¡æœ‰ä»æœºï¼Œéƒ½ä¸å¯ä»¥è¿›è¡Œå†™æ“ä½œ

### å“¨å…µæ¨¡å¼

- è§£å†³ä¸»ä»å¤åˆ¶çš„ç¼ºé™·ï¼šä¸»æœºå®•æœºæ—¶ï¼Œä»æœºç­‰å¾…ï¼›å“¨å…µæ¨¡å¼å¯ä»¥è§£å†³ä¸»æœºå®•æœºæ—¶ï¼Œè‡ªåŠ¨è®¾ç½®ä¸€ä¸ªä»æœºä¸ºä¸»æœº

- è‡ªåŠ¨å®Œæˆï¼šä¸»æœºå®•æœºã€ä»æœºä¸Šä½

- å¸ƒç½®å“¨å…µ

  1. æä¾›ä¸€ä¸ªå“¨å…µçš„é…ç½®æ–‡ä»¶ï¼šredis_sentinel.conf

     ```tex
     sentinel monitor dc-redis ip port 1
     ```

  2. ä»¥ä¸Šå“¨å…µæ–‡ä»¶ä»£è¡¨ï¼šç›‘æ§ä¸»æœºçš„ipåœ°å€ï¼Œportç«¯å£ï¼Œå¾—åˆ°å“¨å…µçš„æŠ•ç¥¨æ•°ï¼ˆå½“å“¨å…µæŠ•ç¥¨æ•°å¤§äºæˆ–ç­‰äºæ­¤æ•°æ—¶ åˆ‡æ¢ä¸»ä»å…³ç³»ï¼‰

  3. `redis-sentinel å“¨å…µé…ç½®æ–‡ä»¶`ï¼šé€šè¿‡é…ç½®æ–‡ä»¶å¯åŠ¨å“¨å…µæ¨¡å¼

- ä¸»æœºå®•æœºï¼Œå“¨å…µè‡ªåŠ¨è®¾ç½®ä¸€ä¸ªä»æœºä¸ºä¸»æœº

- ä¸»æœºæ¢å¤ï¼Œæ‰€æœ‰ä»æœºä»å±äºæ–°ä¸»æœº

### å°ç»“

- å“¨å…µæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„redisèŠ‚ç‚¹
- æŸ¥çœ‹ä»ä¸»å…³ç³»ï¼š`info replication`
- è®¾ç½®ä¸»ä»å…³ç³»å‘½ä»¤ï¼š`slaveof ä¸»æœºip ä¸»æœºport`
- å¼€å¯å“¨å…µæ¨¡å¼ï¼š`redis-sentinel sentinel.conf`
- ä¸»ä»å¤åˆ¶åŸåˆ™ï¼šå¼€å§‹ä¸ºå…¨é‡å¤åˆ¶ï¼Œä¹‹åæ˜¯å¢é‡å¤åˆ¶
- å“¨å…µæ¨¡å¼ä¸‰å¤§ä»»åŠ¡ï¼šç›‘æ§ã€æé†’ã€è‡ªåŠ¨æ•…éšœè¿ç§»
- ç¼ºç‚¹ï¼šä¸»ä»å¤åˆ¶ä¼šæœ‰å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿç¹å¿™æ—¶å»¶è¿Ÿé—®é¢˜åŠ é‡ï¼Œå½“ä»æœºæ•°é‡è¿‡å¤šæ—¶ä¹Ÿä¼šåŠ é‡å»¶è¿Ÿ

## Jedis

rediså®˜æ–¹æ¨èjavaä½¿ç”¨jedisæ“ä½œredisï¼ŒjedisåŒ…æ‹¬äº†redisæ“ä½œå‡ ä¹æ‰€æœ‰å‘½ä»¤ï¼Œredisæ‰€æœ‰å‘½ä»¤åœ¨jedisä¸­ä»¥æ–¹æ³•å½¢å¼å‡ºç°

### æ·»åŠ jedisä¾èµ–

pom.xml

```xml
<!-- https://mvnrepository.com/artifact/redis.clients/jedis -->
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>3.3.0</version>
</dependency>
```

### jedisä½¿ç”¨

- è¿æ¥redisï¼Œéœ€è¦åœ¨redisé…ç½®æ–‡ä»¶é…ç½® bind ip

  Jedis jedis=new Jedis(host,port)

  jedis.ping() ï¼šæŸ¥çœ‹redisæœåŠ¡å™¨æ˜¯å¦å·¥ä½œ

- keyæ“ä½œ
  - jedis.keys("*")ï¼šæŸ¥çœ‹redisæ‰€æœ‰åº“
  - jedis.move("key",1)ï¼šå°†æŒ‡å®š key ç§»åŠ¨åˆ°æŸä¸€ä¸ªåº“
- stringæ“ä½œ
  - jedis.set("key","value")ï¼šè®¾ç½®keyï¼Œvalue
  - jedis.get("key")ï¼šè·å–æŸä¸ªkeyçš„å€¼
  - jedis.append("key","str")ï¼šå‘æŸä¸ªkeyçš„å€¼è¿›è¡Œè¿½åŠ å­—ç¬¦ä¸²
- äº‹åŠ¡æ“ä½œ
  - Transacton tran=jedis.multi()ï¼šå¼€å¯äº‹åŠ¡
  - tran.set("key","value")ï¼šå‘äº‹åŠ¡ä¸­æ·»åŠ æŒ‡ä»¤
  - tran.exec()ï¼šæ‰§è¡Œäº‹åŠ¡

```java
public static void main(String[] args) {
    Jedis jedis=new Jedis("192.168.10.129",6379);
    jedis.set("key1","value1");
    Transaction tran=jedis.multi();
    tran.lpush("list","a","b","c");
    tran.exec();
    System.out.println(jedis.keys("*"));
    System.out.println(jedis.get("key1"));
    System.out.println(jedis.lrange("list", 0, -1));
}
```

### jedisè¿æ¥æ± çš„ä½¿ç”¨

1. å¯¼å…¥ä¾èµ–

   ```xml
   <!-- https://mvnrepository.com/artifact/redis.clients/jedis -->
   <dependency>
       <groupId>redis.clients</groupId>
       <artifactId>jedis</artifactId>
       <version>3.3.0</version>
   </dependency>
   <!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->
   <dependency>
       <groupId>org.apache.commons</groupId>
       <artifactId>commons-lang3</artifactId>
       <version>3.12.0</version>
   </dependency>
   ```

   

2. ç¼–å†™å¦‚ä¸‹å·¥å…·ç±»

   ```java
   public class JedisUtil {
       private static JedisPool jedisPool=null;
       // è®¾å®šè¿æ¥è¶…æ—¶æ—¶é—´
       private static final int POOL_TIMEOUT=10000;
       static {
           JedisPoolConfig config=new JedisPoolConfig();
           config.setMaxTotal(10);     //è®¾ç½®jedisæœ€å¤§å®ä¾‹æ•°
           config.setMaxIdle(5);       //è®¾ç½®jedisæœ€å¤§ç©ºé—²å®ä¾‹æ•°
           config.setMaxWaitMillis(1000*10);   //å½“å¼•å…¥jedisæœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´ç›´æ¥æŠ›å‡ºJedisConnectionException
           config.setTestOnBorrow(true);       //å½“å¼•å…¥jedisæ—¶æ˜¯å¦æå‰æµ‹è¯•ï¼Œå¼€å¯åˆ™æ‰€æœ‰è·å–çš„jediså®ä¾‹å‡ä¸ºå¯ç”¨çš„
           jedisPool=new JedisPool(config,"192.168.10.131",6379,POOL_TIMEOUT,"123456");
       }
       //è·å–jedisè¿æ¥
       public static Jedis getJedis(){
           return jedisPool.getResource();
       }
       //å…³é—­è¿æ¥æ± 
       public static void closeJedis(Jedis jedis){
           if (jedis!=null){
               jedis.close();
           }
       }
   }
   

3. æµ‹è¯•ï¼Œ`ä»è¿æ¥æ± è·å–åˆ°çš„jedisè¿æ¥éœ€è¦å…³é—­`

   ```java
   private static void test2() {
       for (int i=0;i<20;i++){
           Jedis jedis = JedisUtil.getJedis();
           jedis.set("key"+i,"value"+i);
       }
       // å¦‚æœä¸åŠæ—¶å…³é—­jedis
       //å½“è¿æ¥å æ»¡åï¼Œå½“è®¾å®šæ—¶é—´åæ²¡è·å–åˆ°è¿æ¥æŠ›é”™ï¼šJedisExhaustedPoolException
       // jedis.close();  //å…³é—­jedisï¼Œå›åˆ°è¿æ¥æ± 
   }
   ```

## Jedisæœ€æ–°(2022)

### å¯¼å…¥ä¾èµ–

```xml
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
    <version>4.1.1</version>
</dependency>
```

### åˆ›å»ºå·¥å…·ç±»

```java
public class JedisUtil {
    private static final int POOL_TIMEOUT=10000;
    private static JedisPool jedisPool=null;
    static {
        JedisPoolConfig config=new JedisPoolConfig();
        config.setMaxTotal(10);   //è®¾ç½®jedisæœ€å¤§å®ä¾‹æ•°
        config.setMaxIdle(5); //è®¾ç½®jedisæœ€å¤§ç©ºé—²å®ä¾‹æ•°
        config.setTestOnBorrow(true);       //å½“å¼•å…¥jedisæ—¶æ˜¯å¦æå‰æµ‹è¯•ï¼Œå¼€å¯åˆ™æ‰€æœ‰è·å–çš„jediså®ä¾‹å‡ä¸ºå¯ç”¨çš„
        jedisPool=new JedisPool(config,"192.168.10.131",6379,POOL_TIMEOUT);
    }
    //è·å–jedisè¿æ¥
    public static Jedis getJedis(){
        return jedisPool.getResource();
    }
    //å…³é—­è¿æ¥æ± 
    //å½“è¿æ¥å æ»¡åï¼Œå½“è®¾å®šæ—¶é—´åæ²¡è·å–åˆ°è¿æ¥æŠ›é”™ï¼šJedisExhaustedPoolException
    public static void closeJedis(Jedis jedis){
        if (jedis!=null){
            jedis.close();
        }
    }
    //å­˜æ”¾Stringç±»å‹æ•°æ®
    public static void putStr(String key, String value){
        Jedis jedis = getJedis();
        jedis.set(key,value);
        closeJedis(jedis);
    }
    //è·å–Stringç±»å‹æ•°æ®
    public static String getStr(String key){
        Jedis jedis = getJedis();
        String s = jedis.get(key);
        closeJedis(jedis);
        return s;
    }
    //å­˜å‚¨hash
    public static void setHash(String key, Map<String,String> map){
        Jedis jedis = getJedis();
        jedis.hset(key,map);
        closeJedis(jedis);
    }
    //è·å–hash
    public static Map<String,String> getHash(String key){
        Jedis jedis = getJedis();
        Map<String, String> map = jedis.hgetAll(key);
        closeJedis(jedis);
        return map;
    }
    //å­˜å‚¨åˆ—è¡¨
    public static void setList(String key, String... value){
        Jedis jedis = getJedis();
        jedis.rpush(key,value);
        closeJedis(jedis);
    }
    //è·å–åˆ—è¡¨
    public static List<String> getList(String key,Long start,Long end){
        Jedis jedis = getJedis();
        List<String> list = jedis.lrange(key, start, end);
        closeJedis(jedis);
        return list;
    }
    //å­˜å‚¨é›†åˆ
    public static void setSet(String key, String... value){
        Jedis jedis = getJedis();
        jedis.sadd(key,value);
        closeJedis(jedis);
    }
    //è·å–é›†åˆ
    public static Set<String> getSet(String key){
        Jedis jedis = getJedis();
        Set<String> smembers = jedis.smembers(key);
        closeJedis(jedis);
        return smembers;
    }
    //å­˜å‚¨æœ‰åºé›†åˆ
    public static void setZSet(String key,Double score,String value){
        Jedis jedis = getJedis();
        jedis.zadd(key,score,value);
        closeJedis(jedis);
    }
    //è·å–æœ‰åºé›†åˆ
    public static List<Tuple> getZSet(String key,Long scoreStart,Long scoreEnd){
        Jedis jedis = getJedis();
        List<Tuple> tuples = jedis.zrangeWithScores(key, scoreStart, scoreEnd);
        closeJedis(jedis);
        return tuples;
    }
}
```





